<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="btn btn-outline-primary" (click)="volverAProyectos()">
      <i class="bi bi-arrow-left"></i> Volver a Proyectos
    </button>
    <h1 class="h3 mb-0">Tareas del Proyecto</h1>
    <button class="btn btn-primary" (click)="crearTarea()">
      <i class="bi bi-plus-circle"></i> Nueva Tarea
    </button>
  </div>

  
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Lista de Tareas</h5>
      <small *ngIf="proyectoNombre">{{ proyectoNombre }}</small>
    </div>

    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Buscador -->
        <div class="flex-grow-1 me-3">
          <div class="input-group">
            <input type="text" class="form-control"
                   [(ngModel)]="searchTerm"
                   (input)="filtrarTareas()"
                   placeholder="Buscar por ID, título o estado (completada/pendiente)">
            <button *ngIf="searchTerm" class="btn btn-outline-secondary"
                    (click)="searchTerm=''; filtrarTareas()">
              <i class="bi bi-x-circle"></i>
            </button>
          </div>
        </div>

   
        <div>
          <select class="form-select" style="width: auto;" [(ngModel)]="pageSize" (change)="actualizarPaginacion()">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </div>
      </div>

  
      <div *ngIf="isLoading" class="text-center my-4">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">Cargando tareas...</p>
      </div>

 
      <div *ngIf="!isLoading">
        <!-- Sin tareas -->
        <div *ngIf="paginatedTareas.length === 0" class="text-center text-muted my-4">
          <i class="bi bi-clipboard-x fs-1"></i>
          <p>{{ searchTerm ? 'No se encontraron tareas que coincidan con la búsqueda' : 'No hay tareas registradas' }}</p>
          <button *ngIf="!searchTerm" class="btn btn-primary mt-2" (click)="crearTarea()">
            Crear primera tarea
          </button>
        </div>

     
        <table *ngIf="paginatedTareas.length > 0" class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Usuario ID</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tarea of paginatedTareas; trackBy: trackByTareaId">
              <td>{{ tarea.id }}</td>
              <td>
                <span [class.text-decoration-line-through]="tarea.completed">{{ tarea.title }}</span>
              </td>
              <td>{{ tarea.userId }}</td>
              <td>
                <span class="badge" [class.bg-success]="tarea.completed" [class.bg-warning]="!tarea.completed">
                  {{ tarea.completed ? 'Completada' : 'Pendiente' }}
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
               
                  <button class="btn btn-outline-success" (click)="toggleCompletada(tarea)">
                    {{ tarea.completed ? 'Marcar pendiente' : 'Marcar completada' }}
                  </button>
               
                  <button class="btn btn-warning" (click)="editarTarea(tarea.id)">
                    <i class="bi bi-pencil"></i> Editar
                  </button>
                
                  <button class="btn btn-danger" (click)="eliminarTarea(tarea.id, tarea.title)">
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

   
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="cambiarPagina(currentPage - 1)">Anterior</button>
            </li>

            <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
                [class.active]="currentPage === i+1">
              <button class="page-link" (click)="cambiarPagina(i+1)">{{ i+1 }}</button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="cambiarPagina(currentPage + 1)">Siguiente</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
